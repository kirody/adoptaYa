<div class="management-panel-container">
  <app-header-page [title]="'Panel de Gestión'" [icon]="'fas fa-cog'"></app-header-page>
  <div class="card flex justify-center" *ngIf="isLoading">
    <p-progress-spinner strokeWidth="4" fill="transparent" animationDuration=".0.5s"
      [style]="{ width: '50px', height: '50px' }" />
  </div>
  <div class="card h-50" *ngIf="!isLoading">
    <p-tabs value="{{ valueTab }}" scrollable>
      <p-tablist>
        <ng-template #previcon>
          <i class="pi pi-minus"></i>
        </ng-template>
        <p-tab value="0" class="flex items-center !gap-2" (click)="tabAnimals()">
          <i class="fa fa-paw"></i>
          <span class="font-bold whitespace-nowrap">Animales</span>
          <p-tag severity="warn" [value]="countTabAnimals" [rounded]="true" />
        </p-tab>
        <p-tab value="1" class="flex items-center !gap-2" (click)="tabPending()">
          <i class="fa fa-clock"></i>
          <span class="font-bold whitespace-nowrap">Pendientes</span>
          <p-tag severity="warn" [value]="countTabPending" [rounded]="true" />
        </p-tab>
        <p-tab value="2" class="flex items-center !gap-2">
          <i class="fa fa-exclamation-triangle"></i>
          <span class="font-bold whitespace-nowrap">Escalados</span>
          <p-tag severity="warn" value="0" [rounded]="true" />
        </p-tab>
        <p-tab value="3" class="flex items-center !gap-2">
          <i class="fa fa-file"></i>
          <span class="font-bold whitespace-nowrap">Solicitudes</span>
          <p-tag severity="warn" value="0" [rounded]="true" />
        </p-tab>
        <p-tab value="4" class="flex items-center !gap-2" (click)="tabUsers()">
          <i class="fa fa-users"></i>
          <span class="font-bold whitespace-nowrap">Usuarios</span>
          <!-- <p-tag severity="warn" value="0" [rounded]="true" /> -->
        </p-tab>
        <ng-template #nexticon>
          <i class="pi pi-plus"></i>
        </ng-template>
      </p-tablist>
      <p-tabpanels>
        <p-tabpanel value="0">
          @if (dataTable() && dataTable().length > 0) {
          <p-table [value]="dataTable()" [tableStyle]="{ 'min-width': '60rem' }">
            <ng-template #caption>
            </ng-template>
            <ng-template #header>
              <tr>
                <th>Imagen</th>
                <th>Nombre</th>
                <th>Especie</th>
                <th>Género</th>
                <th>Edad</th>
                <th>Estado</th>
                <th>Publicado</th>
                <th>Protectora</th>
                <th>Acciones</th>
              </tr>
            </ng-template>
            <ng-template #body let-animal>
              <tr>
                <td>
                  <img [src]="animal.urlImage" [alt]="animal.name" class="w-2rem rounded" />
                </td>
                <td>{{ animal.name }} </td>
                <td>
                  <i class="fa-solid"
                    [ngClass]="{'fa-cat': animal.specie === 'Gato', 'fa-dog': animal.specie === 'Perro'}"></i>
                </td>
                <td>
                  <i class="fa-solid"
                    [ngClass]="{'fa-mars': animal.gender === 'Macho', 'fa-venus': animal.gender === 'Hembra'}"></i>
                </td>
                <td>{{ animal.age | formattedAge}}</td>
                <td>
                  <p-tag [value]="formattedStates(animal)" [severity]="getStatus(animal)" [rounded]="true" />
                </td>
                <td>
                  <i *ngIf="animal.published" class="fa-solid fa-circle-check" style="color: #47d021;"
                    aria-hidden="true"></i>
                  <i *ngIf="!animal.published" class="fa-solid fa-circle-xmark" style="color: #ff4343;"
                    aria-hidden="true"></i>
                </td>
                <td>{{ animal.protectressName }}</td>
                <td>
                  <p-button icon="fa-solid fa-pen-to-square"
                    styleClass="p-button-rounded p-button-warning p-button-text"
                    (click)="editAnimal(animal.id)"></p-button>
                  <p-button icon="fa-solid fa-trash" styleClass="p-button-rounded p-button-warning p-button-text"
                    (click)="modalconfirmation($event, animal, 'delete')"></p-button>
                  <p-button icon="fa-solid"
                    [ngClass]="{'fa-eye-slash': animal.published, 'fa-cloud-arrow-up': !animal.published}"
                    styleClass="p-button-rounded p-button-warning p-button-text"
                    (click)="modalconfirmation($event, animal, 'publish')"></p-button><!-- [disabled]="animal.published" -->
                </td>
              </tr>
            </ng-template>
            <ng-template #footer>
              <tr>
                <td colspan="5" class="font-bold">Total {{ dataTable() ? dataTable().length : 0 }} animales.</td>
              </tr>
            </ng-template>
          </p-table>
          } @else {
          <app-card-nodata message="No hay animales disponibles para gestionar."></app-card-nodata>
          }
        </p-tabpanel>
        <p-tabpanel value="1">
          @if (dataTable() && dataTable().length > 0) {
          <p-table [value]="dataTable()" [tableStyle]="{ 'min-width': '60rem' }">
            <ng-template #caption>
            </ng-template>
            <ng-template #header>
              <tr>
                <th>Imagen</th>
                <th>Nombre</th>
                <th>Especie</th>
                <th>Género</th>
                <th>Edad</th>
                <th>Estado</th>
                <th>Publicado</th>
                <th>Protectora</th>
                <th>Acciones</th>
              </tr>
            </ng-template>
            <ng-template #body let-animal>
              <tr>
                <td>
                  <img [src]="animal.urlImage" [alt]="animal.name" class="w-2rem rounded" />
                </td>
                <td>{{ animal.name }} </td>
                <td>
                  <i class="fa-solid"
                    [ngClass]="{'fa-cat': animal.specie === 'Gato', 'fa-dog': animal.specie === 'Perro'}"></i>
                </td>
                <td>
                  <i class="fa-solid"
                    [ngClass]="{'fa-mars': animal.gender === 'Macho', 'fa-venus': animal.gender === 'Hembra'}"></i>
                </td>
                <td>{{ animal.age | formattedAge}}</td>
                <td>
                  <p-tag [value]="formattedStates(animal)" [severity]="getStatus(animal)" [rounded]="true" />
                </td>
                <td>
                  <i *ngIf="animal.published" class="fa-solid fa-circle-check" style="color: #47d021;"
                    aria-hidden="true"></i>
                  <i *ngIf="!animal.published" class="fa-solid fa-circle-xmark" style="color: #ff4343;"
                    aria-hidden="true"></i>
                </td>
                <td>{{ animal.protectressName }}</td>
                <td>
                  <p-button icon="fa-solid fa-pen-to-square"
                    styleClass="p-button-rounded p-button-warning p-button-text"
                    (click)="editAnimal(animal.id)"></p-button>
                  <p-button icon="fa-solid fa-trash" styleClass="p-button-rounded p-button-warning p-button-text"
                    (click)="modalconfirmation($event, animal, 'delete')"></p-button>
                  <p-button icon="fa-solid"
                    [ngClass]="{'fa-eye-slash': animal.published, 'fa-cloud-arrow-up': !animal.published}"
                    styleClass="p-button-rounded p-button-warning p-button-text"
                    (click)="modalconfirmation($event, animal, 'publish')"></p-button><!-- [disabled]="animal.published" -->
                </td>
              </tr>
            </ng-template>
            <ng-template #footer>
              <tr>
                <td colspan="5" class="font-bold">Total {{ dataTable() ? dataTable().length : 0 }} animales.</td>
              </tr>
            </ng-template>
          </p-table>
          } @else {
          <app-card-nodata message="No hay animales disponibles para gestionar."></app-card-nodata>
          }
        </p-tabpanel>
        <p-tabpanel value="2">
          <app-card-nodata [message]="'En contrucción...'"></app-card-nodata>
        </p-tabpanel>
        <p-tabpanel value="3">
          <app-card-nodata [message]="'En contrucción...'"></app-card-nodata>
        </p-tabpanel>
        <p-tabpanel value="4">
          @if (dataTable() && dataTable().length > 0) {
          <p-table [value]="dataTable()" [tableStyle]="{ 'min-width': '60rem' }">
            <ng-template #caption>
            </ng-template>
            <ng-template #header>
              <tr>
                <th>Nombre</th>
                <th>Email</th>
                <th>Rol</th>
              </tr>
            </ng-template>
            <ng-template #body let-user>
              <tr>
                <td>{{ user.username }} </td>
                <td>{{ user.email }} </td>
                <td>
                  <div class="field h-4rem">
                    <!-- <p-tag [severity]="user.role === 'ROLE_ADMIN' ? 'warn' : 'secondary'" [value]="user.role" /> -->
                    <p-select id="state" [(ngModel)]="user.role" [options]="roles" optionLabel="label"
                      optionValue="value" placeholder="Selecciona un rol" styleClass="w-full"
                      (onChange)="updateRolUser(user)" filter="true" appendTo="body">
                    </p-select>
                  </div>
                </td>
              </tr>
            </ng-template>
            <ng-template #footer>
              <tr>
                <td colspan="5" class="font-bold">Total {{ dataTable() ? dataTable().length : 0 }} usuarios registrados.
                </td>
              </tr>
            </ng-template>
          </p-table>
          } @else {
          <app-card-nodata message="No hay animales disponibles para gestionar."></app-card-nodata>
          }
        </p-tabpanel>
      </p-tabpanels>
    </p-tabs>
  </div>
</div>

<p-button (click)="showDialog()" label="Show" />
<p-dialog header="Escalar a un Admin" [modal]="true" [(visible)]="visible" [style]="{ width: '25rem' }">
  <span class="p-text-secondary block mb-4">Envia un mensaje a un Administrador para que revise tu caso</span>
  <div class="flex items-center gap-4 mb-4">
    <input pInputText id="text" class="flex-auto" autocomplete="off" />
  </div>
  <div class="flex justify-end gap-2">
    <p-button label="Cancelar" severity="secondary" (click)="visible = false" />
    <p-button label="Enviar" (click)="visible = false" />
  </div>
</p-dialog>

<p-toast />
<p-confirmdialog />
