<div class="">
  <app-header-page [title]="animal()?.name || 'Detalle del Animal'" [icon]="icon"></app-header-page>

  <div class="card flex justify-center" *ngIf="isLoading()">
    <p-progress-spinner strokeWidth="4" fill="transparent" animationDuration=".0.5s"
      [style]="{ width: '50px', height: '50px' }" />
  </div>

  <div *ngIf="!isLoading() && animal() as currentAnimal" class="animal-detail-container flex mt-4">
    <div class="col-12 md:col-6 flex justify-center items-start p-4">
      <div class="image-container relative rounded-lg overflow-hidden shadow-md">
        <img class="animal-image" [src]="currentAnimal.urlImage" [alt]="currentAnimal.name" />
        <p-tag [value]="formattedStates(currentAnimal)" [severity]="getStatus(currentAnimal)"
          class="status-tag absolute" />
      </div>
    </div>
    <div class="col-12 md:col-6">
      <div class="p-4">
        <div class="mt-2">
          <h3 class="font-semibold text-xl mb-2">
            Detalles
            <i [class]="`fa-solid ${icon} mr-2`"></i>
            <i [class]="`fa-solid ${gender} mr-2`"></i>
          </h3>
          <ul class="list-none p-0 m-0">
            <li class="flex items-center py-2 border-b border-surface-200 dark:border-surface-700">
              <span class="font-semibold w-1/3">Edad:</span>
              <span>{{ currentAnimal.age }} años</span>
            </li>
            <li class="flex items-center py-2 border-b border-surface-200 dark:border-surface-700">
              <span class="font-semibold w-1/3">Raza:</span>
              <span>{{ currentAnimal.race }}</span>
            </li>
            <li class="flex items-center py-2 border-b border-surface-200 dark:border-surface-700">
              <span class="font-semibold w-1/3">Provincia:</span>
              <span>{{ currentAnimal.province }}</span>
            </li>
            <li class="flex items-center py-2 border-b border-surface-200 dark:border-surface-700">
              <span class="font-semibold w-1/3">Tamaño:</span>
              <span>{{ currentAnimal.size }}</span>
            </li>
          </ul>
        </div>

        <div class="mt-6">
          <h3 class="font-semibold text-xl mb-2">Sobre {{currentAnimal.name}}</h3>
          <p class="text-surface-700 dark:text-surface-300 leading-relaxed">
            {{ currentAnimal.description }}
          </p>
        </div>

        <div class="mt-8 flex gap-2">
          <button pButton label="Solicitar adopción" icon="pi pi-heart" class="w-full md:w-auto"
            (click)="adoptionRequest()"></button>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="!isLoading() && !animal()" class="text-center p-6">
    <p class="text-xl text-surface-500">No se pudo encontrar el animal.</p>
  </div>
</div>

<p-dialog header="Solicitud de adopción" [modal]="true" [(visible)]="showModalAdoption" [style]="{ width: '60rem' }">
  <span class="p-text-secondary block mb-4"></span>
  <form [formGroup]="requestForm">
    <div class="flex gap-6">
      <div class="w-1/2">
        <div class="field">
          <label for="name" class="form-label">Nombre del solicitante</label>
          <input id="name" type="text" pInputText formControlName="name" class="w-full" />
        </div>
        <div class="field">
          <div class="field">
            <label for="phone" class="form-label">Teléfono</label>
            <input id="phone" type="text" pInputText formControlName="phone" class="w-full" />
          </div>
        </div>
        <div class="field">
          <label for="address" class="form-label">Dirección</label>
          <input id="address" type="text" pInputText formControlName="address" class="w-full" />
        </div>
        <div class="field">
          <label for="email" class="form-label">Correo electrónico</label>
          <input id="email" type="text" pInputText formControlName="email" class="w-full" />
        </div>
      </div>

      <div class="w-1/2">
        <div class="field">
          <label for="question1" class="form-label">¿Cuántas horas al día pasaría el animal solo en casa?</label>
          <textarea id="question1" rows="2" cols="10" pTextarea formControlName="question1"
            class="w-full"></textarea>
        </div>
        <div class="field">
          <label for="question2" class="form-label">Si vives en un piso, ¿tienes terraza o balcón?
            ¿Están debidamente protegidos para evitar caídas (redes, cerramientos)?</label>
          <textarea id="question2" rows="2" cols="10" pTextarea formControlName="question2"
            class="w-full"></textarea>
        </div>
        <div class="field">
          <label for="question3" class="form-label">¿Hay zonas de la casa a las que el animal no podrá acceder?</label>
          <textarea id="question3" rows="2" cols="10" pTextarea formControlName="question3"
            class="w-full"></textarea>
        </div>
      </div>
    </div>
  </form>
  <div class="flex justify-end gap-2">
    <p-button label="Cancelar" severity="secondary" (click)="showModalAdoption = false" />
    <p-button label="Enviar Solicitud" icon="pi pi-send" [disabled]="!requestForm.valid" (click)="sendAdoptionRequest()"/>
  </div>
</p-dialog>
